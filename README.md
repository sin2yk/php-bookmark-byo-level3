# ①課題名
BYOワイン会・持ち寄りボトル登録アプリ（PHP版アンケート / v4.0 ログイン対応）

## ②課題内容（どんな作品か）

- 「すでに開催が決まっているワイン会」の **持ち寄りワイン情報だけ** を事前に集めるための軽量Webアプリ。
- 参加者はURLにアクセスして、自分の持ち寄りボトルをフォームから登録する。
- アプリ側では、ワインの **タイプ（泡・白・赤など）／価格帯／テーマ適合度** を構造化して保存。
- 参加者は、自分が持ち込む予定のワインと、会全体の雰囲気を一覧で把握できる。
- 幹事は「幹事ビュー（list_admin）」から、タイプや価格帯のバランス、テーマ適合度の平均などを確認し、事前に微調整ができる。
- v4.0 では、ログイン機能とユーザー権限（organizer / guest）を実装し、幹事用・参加者用の画面を分けた。

## ③アプリのデプロイURL

- XAMPP ローカル環境で動作確認  
  - 例）`http://localhost/BYO/login.php`

（本課題ではローカル実行のみ）

## ④アプリのログイン用IDまたはPassword（ある場合）

※実際のID/PWは自分の環境に合わせて書き換え

- 幹事（organizer 権限）  
  - ID: `organizer1`  
  - PW: `pass1234`

- ゲスト（guest 権限）  
  - ID: `guest1`  
  - PW: `pass1234`

## ⑤工夫した点・こだわった点

- **スコープを「BYO登録だけ」に絞った設計**
  - 日程調整や出欠管理は既存ツール（LINEスケジュール等）に任せ、
  - このアプリは「開催が確定しているワイン会の、持ち寄りボトル登録と一覧表示」に特化させた。

- **ワイン会らしい項目設計**
  - タイプ（泡／白／赤／ロゼ等）、価格帯（おおよそのレンジ）、テーマ適合度（1〜5）を構造化して保存。
  - 幹事が「泡が少なすぎる」「価格帯バラバラ」などの崩壊を、当日ではなく **事前に検知できる** ようにした。

- **ログイン＋ロール設計（v4.0）**
  - `users` テーブルを追加し、`role` カラムで `organizer / guest` を管理。
  - `login.php / login_act.php / logout.php` を実装し、`loginCheck()` で保護したページだけアクセス可能にした。
  - 幹事だけがアクセスできる `list_admin.php` を用意し、全ボトルのフル情報を確認・編集できるようにした。

- **ゲストの編集フロー**
  - ゲストは通常のUIからは削除／変更できない設計にしつつ、
  - 幹事から `edit.php?id=◯` のURLをもらえば、自分のボトルに限りログイン後に変更・削除できるようにした。
  - 「幹事が全体をコントロールしつつ、参加者にも自己責任で修正の余地を残す」という運用を想定。

- **共通関数・DB接続の分離**
  - `db_connect.php` に `get_pdo()`（＋互換用 `db_conn()`）をまとめ、全ファイルから共通で利用。
  - `funcs.php` に `h()` / `sql_error()` / `redirect()` / `loginCheck()` を集約し、セキュリティと可読性を意識した。

## ⑥難しかった点・次に実装したいこと

- **難しかった点**
  - フォームの `name` と `$_POST` 側の受け取り名がズレていて、「必須項目未入力」エラーが続いた。
  - `h()` 関数の定義を各ファイルに書いてしまい、`Cannot redeclare h()` エラーになったため、`funcs.php` に一本化した。
  - セッション開始位置や `loginCheck()` の呼び出し順を揃えるまで、`$_SESSION` 未定義エラーに何度かはまった。

- **次に実装したいこと（卒業制作での最終形態に向けて）**
  - **ブラインド設定の本実装**
    - `blind_level` / `blind_password_hash` カラムを追加し、参加者ビューではワイン名やヴィンテージをマスク表示。
    - 幹事ビューではフル情報を表示しつつ、「見せ方」だけ参加者ごとに変えられるようにする。
  - **権限の厳密化**
    - `edit.php` で「ログインユーザー ≠ 登録者」の場合は編集させないなど、IDベースのアクセス制御を強化。
  - **UI / UX 改善**
    - header/nav の重複を共通パーツに切り出し、全ページの見た目と導線を整理。
    - 幹事ビューにタイプ別・価格帯別・テーマ適合度の簡易サマリーを表示し、「ワイン会ダッシュボード」に近づける。
